@{
    ViewData["Title"] = "AI Image Generator";
}

<div class="container mt-5 text-center">

    <h2 class="mb-4">🧠 AI Image Generator</h2>

    <div class="mb-3">
        <input type="text"
               id="promptInput"
               class="form-control form-control-lg"
               placeholder="Enter your creative prompt..." />
    </div>

    <button class="btn btn-primary btn-lg"
            onclick="generateImage()">
        Generate Image
    </button>

    <div id="loading" class="mt-4" style="display:none;">
        <div class="spinner-border text-primary"></div>
        <p>Generating image... please wait</p>
    </div>

    <div id="resultSection" class="mt-4" style="display:none;">
        <img id="resultImage"
             class="img-fluid rounded shadow"
             style="max-width:500px;" />

        <br /><br />

        <a id="downloadBtn"
           class="btn btn-success"
           download>
            Download Image
        </a>
    </div>

</div>

<script>
    async function generateImage() {

        const prompt = document.getElementById("promptInput").value;

        if (!prompt) {
            alert("Please enter a prompt.");
            return;
        }

        document.getElementById("loading").style.display = "block";
        document.getElementById("resultSection").style.display = "none";

        try {
            const response = await fetch("/api/image/generate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ prompt: prompt })
            });

            if (!response.ok) {
                alert("Image generation failed.");
                document.getElementById("loading").style.display = "none";
                return;
            }

            const data = await response.json();

            const img = document.getElementById("resultImage");
            const download = document.getElementById("downloadBtn");

            img.src = data.imageUrl;
            download.href = data.imageUrl;

            document.getElementById("loading").style.display = "none";
            document.getElementById("resultSection").style.display = "block";
        }
        catch (error) {
            alert("Error generating image.");
            document.getElementById("loading").style.display = "none";
        }
    }
</script>